<section>
  {{#if (eq this.model.kind 'Finals')}}
    <h4>
      (There is no next round to Draw.)
    </h4>
  {{else if (or (eq this.model.status 'New')(eq this.model.status 'Built')(eq this.model.status 'Started'))}}
    <h4>
      The Draw is available after the Round has Completed.
    </h4>
  {{else if (and this.isEditing (eq this.model.status 'Completed'))}}
    <div class='pb-2'>
      <BsButton @type='outline-dark' @disabled={{this.model.isDisabled}} @onClick={{action 'toggleDraw'}}>{{#if this.isEditing}}Draw is Unlocked.  Click to Lock Draw{{else}}Draw is Locked. Click to Unlock Draw{{/if}}</BsButton>
    </div>
    <div class='table-responsive'>
      <table class='table table-hover'>
        <thead class='thead-light'>
          <tr>
            <th>OA</th>
            <th>Name</th>
            <th>Notes</th>
          </tr>
        </thead>
          {{#if this.hasMt}}
            {{#each this.mt as |mtObj|}}
              <tr>
                <td>
                  MT
                </td>
                <td>
                  {{html-safe mtObj.name}}
                </td>
                <td>
                </td>
              </tr>
            {{/each}}
          {{else}}
            No MT advanced
          {{/if}}
          <tbody {{sortable-group onChange=(action "reorderItems")}}>
            {{#each this.sortedAppearances as |item|}}
              <tr {{sortable-item model=item}} {{sortable-handle}}>
                <td>
                  {{item.draw}}
                </td>
                <td>
                  {{html-safe item.name}}
                </td>
                <td>{{item.notes}}</td>
              </tr>
            {{else}}
              <tr>
                <td>(No appearances.)</td>
              </tr>
            {{/each}}
          </tbody>
      </table>
    </div>
    <div class='row'>
      <div class='col-md-6'>
        <p><strong>Note:</strong> To adjust the draw, simply grab a row and reposition it to where you want.  To confirm this initial (random) draw, then grab a row and return to its original position.  Each move reorders the list and saves automatically.</p>
      </div>
    </div>
  {{else}}
    <div>
      {{#if (eq this.model.status 'Completed')}}
    <div class='pb-2'>
          <div class='col-md-6'>
            <BsButton @type='outline-dark' @disabled={{this.model.isDisabled}} @onClick={{action 'toggleDraw'}}>{{#if this.isEditing}}Draw is Unlocked.  Click to Lock Draw{{else}}Draw is Locked.  Click to Unlock Draw{{/if}}</BsButton>
          </div>
        </div>
      {{else}}
        <div class='row'>
          <div class='col-md-6'>
            Once the Round is Finalized further changes are not possible.
          </div>
        </div>
      {{/if}}
    </div>
    <div class='row'>
      <div class='col-md-12'>
        <table class='table table-hover'>
          <thead class='thead-light'>
            <tr>
              <th>Draw</th>
              <th>Name</th>
              <th>Notes</th>
              {{#if (eq this.model.status 'Completed')}}
                <th class="actions">Actions</th>
              {{/if}}
            </tr>
          </thead>
          <tbody>
            {{#if this.hasMt}}
              {{#each this.mt as |mtObj|}}
                <tr>
                  <td>
                    MT
                  </td>
                  <td>
                    {{html-safe mtObj.name}}
                  </td>
                  <td>
                    {{round-draw-remove model=mtObj onRemove=(action 'removeFromDraw')}}
                  </td>
                </tr>
              {{/each}}
            {{else}}
              No MT advanced
            {{/if}}
            {{#each this.sortedAppearances as |appearance|}}
              <tr>
                <td>
                  {{appearance.draw}}
                </td>
                <td>
                  {{html-safe appearance.name}}
                </td>
                <td>
                  {{appearance.notes}}
                </td>
                {{#if (eq this.model.status 'Completed')}}
                <td>
                  {{round-draw-remove model=appearance onRemove=(action 'removeFromDraw')}}
                </td>
                {{/if}}
              </tr>
            {{else}}
              <tr>
                <td>(No appearances.)</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
    {{#if (eq this.model.status 'Completed')}}
      <div class='row'>
        <div class='col-md-12'>
          <p>
            <BsButton @type='success' @disabled={{this.model.isDisabled}} @onClick={{action (mut this.advanceGroupModal) true}}>Add Advancing Group</BsButton>
          </p>
        </div>
      </div>
      <div class='row'>
        <div class='col-md-6'>
          <p><strong>Note:</strong> If you wish to edit the draw, please click the "Unlock Draw" button.  You'll then be able to make adjustments, which will automatically save.</p>
        </div>
      </div>
    {{/if}}
  {{/if}}
</section>
<div>
  <BsModal
    @open={{this.advanceGroupModal}}
    @onHidden={{pipe-action (action (mut this.advanceGroupModal) false) (action (mut this.advanceGroupModalError) false)}}
    as |modal|
  >
    <modal.header>
      <h4>Advance Group</h4>
    </modal.header>
    <modal.body>
      <p>
        Select the group to advance into the next round.
      </p>
      <p>
        <Input
          class='form-control'
          type='tel'
          placeholder='Enter Draw (less than or equal to 0 = MT)'
          @value={{this.draw}}
          min=0
          max=99
        />
      </p>
      <p>
        <PowerSelect
          @options={{this.sortedRoundAppearances}}
          @selected={{this.group}}
          @onChange={{action (mut this.group)}}
          @placeholder="Enter Group Name"
          @allowClear={{true}}
          @renderInPlace={{true}}
          @noMatchesMessage="We Could Not Find a group with that name"
          as |group|
        >
          Group: {{html-safe group.name}} [{{group.bhsId}}]
        </PowerSelect>
      </p>
      {{#if this.advanceGroupModalError}}
      <p class='text-danger'>
        Could not create appearance.  Be sure the draw numbers are unique!  Otherwise, please contact support.
      </p>
      {{/if}}
    </modal.body>
    <modal.footer>
      <BsButton @onClick={{action modal.close}} type="default">Cancel</BsButton>
      <BsButton @type='success' @onClick={{perform this.advanceGroup this.group this.draw}} @disabled={{this.isDisabled}}>
        {{#if this.advanceGroup.isRunning}}
          Advancing <FaIcon @icon="spinner" @spin={{true}} />
        {{else}}
          Advance Group
        {{/if}}
      </BsButton>
    </modal.footer>
  </BsModal>
</div>